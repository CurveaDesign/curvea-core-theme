{%- liquid
  assign container_size = section.settings.container
  assign align = section.settings.align
  assign py = section.settings.py
  assign bg = section.settings.bg
  assign text = section.settings.text
  assign gap = section.settings.gap
  assign column_count = section.settings.column_count

  assign align_class = 'text-left'
  case align
    when 'center'
      assign align_class = 'text-center'
    when 'right'
      assign align_class = 'text-right'
  endcase

  assign py_class = 'py-10 sm:py-14'
  case py
    when 'compact'
      assign py_class = 'py-8 sm:py-10'
    when 'spacious'
      assign py_class = 'py-14 sm:py-20'
  endcase

  assign bg_class = 'bg-white'
  case bg
    when 'neutral-50'
      assign bg_class = 'bg-neutral-50'
    when 'neutral-950'
      assign bg_class = 'bg-neutral-950'
  endcase

  assign text_class = 'text-neutral-900'
  if text == 'white'
    assign text_class = 'text-white'
  endif

  assign gap_class = 'gap-6'
  case gap
    when 'tight'
      assign gap_class = 'gap-4'
    when 'wide'
      assign gap_class = 'gap-10'
  endcase

  assign column_grid_class = 'grid-cols-[minmax(160px,1fr)_repeat(3,minmax(140px,1fr))] sm:grid-cols-[minmax(200px,1fr)_repeat(3,minmax(140px,1fr))]'
  if column_count == '2'
    assign column_grid_class = 'grid-cols-[minmax(160px,1fr)_repeat(2,minmax(140px,1fr))] sm:grid-cols-[minmax(200px,1fr)_repeat(2,minmax(140px,1fr))]'
  endif
-%}

<section class="cc-section {{ py_class }} {{ bg_class }} {{ text_class }}">
  {%- capture header_content -%}
    {%- render 'cc-heading', tag: 'h2', text: section.settings.heading, align: align -%}
    {%- render 'cc-heading', tag: 'p', text: section.settings.subheading, align: align, classes: 'text-base text-current/70' -%}
    {%- if section.settings.button_label != blank and section.settings.button_link != blank -%}
      {%- render 'cc-button', label: section.settings.button_label, href: section.settings.button_link, variant: section.settings.button_variant -%}
    {%- endif -%}
  {%- endcapture -%}

  {%- capture table_content -%}
    <div class="cc-card overflow-hidden">
      <div class="grid {{ column_grid_class }} gap-4 text-sm font-medium text-current/70">
        <div></div>
        <div class="text-center">{{ section.settings.column_1 }}</div>
        <div class="text-center">{{ section.settings.column_2 }}</div>
        {%- if column_count == '3' -%}
          <div class="text-center">{{ section.settings.column_3 }}</div>
        {%- endif -%}
      </div>
      <div class="mt-6 space-y-4">
        {%- for block in section.blocks -%}
          <div class="grid {{ column_grid_class }} items-start gap-4 border-t border-current/10 pt-4 text-sm" {{ block.shopify_attributes }}>
            <div class="flex items-start gap-3">
              {%- if block.settings.icon != blank -%}
                <div class="w-10">
                  {%- render 'cc-media', image: block.settings.icon, aspect: '1/1', classes: 'w-10' -%}
                </div>
              {%- endif -%}
              <div>
                <div class="font-medium text-current">{{ block.settings.feature }}</div>
                {%- if block.settings.detail != blank -%}
                  <div class="text-current/70">{{ block.settings.detail }}</div>
                {%- endif -%}
              </div>
            </div>
            <div class="text-center">{{ block.settings.value_1 }}</div>
            <div class="text-center">{{ block.settings.value_2 }}</div>
            {%- if column_count == '3' -%}
              <div class="text-center">{{ block.settings.value_3 }}</div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
    </div>
  {%- endcapture -%}

  {%- capture section_content -%}
    {%- render 'cc-stack', gap: gap_class, classes: align_class, content: header_content -%}
    {{ table_content }}
  {%- endcapture -%}

  {%- render 'cc-container', size: container_size, content: section_content -%}
</section>

{% schema %}
{
  "name": "CC Comparison",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Compare the options"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "A quick look at what each plan includes."
    },
    {
      "type": "text",
      "id": "column_1",
      "label": "Column 1 label",
      "default": "Starter"
    },
    {
      "type": "text",
      "id": "column_2",
      "label": "Column 2 label",
      "default": "Growth"
    },
    {
      "type": "text",
      "id": "column_3",
      "label": "Column 3 label",
      "default": "Scale"
    },
    {
      "type": "select",
      "id": "column_count",
      "label": "Columns",
      "default": "3",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" }
      ]
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "View full plan"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "select",
      "id": "button_variant",
      "label": "Button style",
      "default": "secondary",
      "options": [
        { "value": "primary", "label": "Primary" },
        { "value": "secondary", "label": "Secondary" },
        { "value": "ghost", "label": "Ghost" }
      ]
    },
    {
      "type": "select",
      "id": "container",
      "label": "Container width",
      "default": "lg",
      "options": [
        { "value": "sm", "label": "Small" },
        { "value": "md", "label": "Medium" },
        { "value": "lg", "label": "Large" },
        { "value": "xl", "label": "Extra large" }
      ]
    },
    {
      "type": "select",
      "id": "py",
      "label": "Vertical spacing",
      "default": "comfort",
      "options": [
        { "value": "compact", "label": "Compact" },
        { "value": "comfort", "label": "Comfort" },
        { "value": "spacious", "label": "Spacious" }
      ]
    },
    {
      "type": "select",
      "id": "bg",
      "label": "Background",
      "default": "white",
      "options": [
        { "value": "white", "label": "White" },
        { "value": "neutral-50", "label": "Neutral 50" },
        { "value": "neutral-950", "label": "Neutral 950" }
      ]
    },
    {
      "type": "select",
      "id": "text",
      "label": "Text color",
      "default": "dark",
      "options": [
        { "value": "dark", "label": "Dark" },
        { "value": "white", "label": "White" }
      ]
    },
    {
      "type": "select",
      "id": "align",
      "label": "Text alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "select",
      "id": "gap",
      "label": "Gap",
      "default": "normal",
      "options": [
        { "value": "tight", "label": "Tight" },
        { "value": "normal", "label": "Normal" },
        { "value": "wide", "label": "Wide" }
      ]
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon"
        },
        {
          "type": "text",
          "id": "feature",
          "label": "Feature",
          "default": "Priority support"
        },
        {
          "type": "text",
          "id": "detail",
          "label": "Detail",
          "default": "Response within 24 hours."
        },
        {
          "type": "text",
          "id": "value_1",
          "label": "Column 1 value",
          "default": "Email"
        },
        {
          "type": "text",
          "id": "value_2",
          "label": "Column 2 value",
          "default": "Chat"
        },
        {
          "type": "text",
          "id": "value_3",
          "label": "Column 3 value",
          "default": "Dedicated"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Classic",
      "blocks": [
        { "type": "feature" },
        { "type": "feature" },
        { "type": "feature" }
      ]
    },
    {
      "name": "Split",
      "blocks": [
        { "type": "feature" },
        { "type": "feature" },
        { "type": "feature" },
        { "type": "feature" }
      ]
    },
    {
      "name": "Minimal",
      "blocks": [
        { "type": "feature" },
        { "type": "feature" }
      ]
    },
    {
      "name": "Editorial",
      "blocks": [
        { "type": "feature" },
        { "type": "feature" },
        { "type": "feature" }
      ]
    }
  ]
}
{% endschema %}
